{
  "hash": "91ed6d21b9f0476261609929af2a2652",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Two-Factor Factorial Design\"\nauthor:\n  - name: \"Longhai Li\"\n    affiliation: \"University of Saskatchewan\"\n    url: \"https://longhaisk.github.io/\"\neditor: source\nexecute:\n  echo: true\n  warning: false\n  message: false\n  cache: false\n  fig-width: 9\n  fig-height: 6\neditor_options: \n  chunk_output_type: console\n---\n\n\n\n\n## Battery Design Experiment\n\nThis analysis explores data from a **two-factor factorial experiment** designed to assess the lifespan of a battery. The experiment investigates two factors: **material type** (with 3 levels) and **operating temperature** (with 3 levels: 15°C, 70°C, and 125°C). The primary goal is to understand not only how each factor individually affects battery life but, more importantly, whether the effect of temperature depends on the material type used. This combined effect is known as an **interaction**.\n\n## Data Setup and Preparation\n\nFirst, we organize the raw data into a structured `data.frame`. This is a best practice in R that makes the data easier to manage and the code more readable. We create columns for the response variable `life` and the two factors, `material` and `temperature`, ensuring they are treated as categorical variables (factors) for the analysis.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## Response variable: battery life\nlife <- c(130,155,74,180,  34,40,80,75,   20,70,82,58,\n          150,188,159,126, 136,122,106,115, 25,70,58,45,\n          138,110,168,160, 174,120,150,139, 96,104,82,60)\n\n## Create the data frame\nbattery_df <- data.frame(\n  life = life,\n  material = factor(rep(1:3, each = 12)),\n  temperature = factor(rep(rep(c(15, 70, 125), each = 4), 3))\n)\n\n## Preview the data\nbattery_df\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   life material temperature\n1   130        1          15\n2   155        1          15\n3    74        1          15\n4   180        1          15\n5    34        1          70\n6    40        1          70\n7    80        1          70\n8    75        1          70\n9    20        1         125\n10   70        1         125\n11   82        1         125\n12   58        1         125\n13  150        2          15\n14  188        2          15\n15  159        2          15\n16  126        2          15\n17  136        2          70\n18  122        2          70\n19  106        2          70\n20  115        2          70\n21   25        2         125\n22   70        2         125\n23   58        2         125\n24   45        2         125\n25  138        3          15\n26  110        3          15\n27  168        3          15\n28  160        3          15\n29  174        3          70\n30  120        3          70\n31  150        3          70\n32  139        3          70\n33   96        3         125\n34  104        3         125\n35   82        3         125\n36   60        3         125\n```\n\n\n:::\n:::\n\n\n\n\n## Exploratory Data Analysis and Visualization\n\nBefore fitting a formal model, we visualize the data to get an intuition for the relationships between the factors and the response.\n\n## Boxplots of Main Effects\n\nBoxplots are excellent for examining the distribution of battery life for each level of our factors independently. This gives us a preliminary look at the **main effects**—the individual impact of material type and temperature.\n\n\n\n\n::: {.cell layout-ncol=\"2\"}\n\n```{.r .cell-code}\nlibrary(ggplot2)\n\n## Boxplot for Material Type\nggplot(battery_df, aes(x = material, y = life, fill = material)) +\n  geom_boxplot() +\n  labs(title = \"Battery Life by Material Type\", x = \"Material Type\", y = \"Life (hours)\") +\n  theme_minimal() +\n  theme(legend.position = \"none\")\n```\n\n::: {.cell-output-display}\n![Distribution of Battery Life by Material and Temperature.](factorial_files/figure-pdf/plot-boxplots-1.pdf)\n:::\n\n```{.r .cell-code}\n## Boxplot for Temperature\nggplot(battery_df, aes(x = temperature, y = life, fill = temperature)) +\n  geom_boxplot() +\n  labs(title = \"Battery Life by Temperature\", x = \"Temperature (°C)\", y = \"Life (hours)\") +\n  theme_minimal() +\n  theme(legend.position = \"none\")\n```\n\n::: {.cell-output-display}\n![Distribution of Battery Life by Material and Temperature.](factorial_files/figure-pdf/plot-boxplots-2.pdf)\n:::\n:::\n\n\n\n\n## Interaction Plot\n\nThe most crucial plot for a factorial experiment is the **interaction plot**. It displays the mean battery life for each combination of material and temperature. If the lines are parallel, it suggests there is no interaction. If the lines are not parallel (i.e., they cross or diverge), it indicates that the effect of temperature on battery life is different for each material type, signaling a likely interaction.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(battery_df, aes(x = temperature, y = life, group = material, color = material)) +\n  stat_summary(fun = mean, geom = \"line\", size = 1) +\n  stat_summary(fun = mean, geom = \"point\", size = 3) +\n  labs(\n    title = \"Interaction Plot: Material Type and Temperature\",\n    x = \"Temperature (°C)\",\n    y = \"Average Battery Life (hours)\",\n    color = \"Material Type\"\n  ) +\n  theme_minimal() +\n  theme(plot.title = element_text(hjust = 0.5))\n```\n\n::: {.cell-output-display}\n![Interaction between Material Type and Temperature.](factorial_files/figure-pdf/plot-interaction-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n\n\nThe non-parallel lines in the plot strongly suggest that a significant interaction effect is present. Specifically, the performance of Material 3 drops less dramatically with increasing temperature compared to Materials 1 and 2.\n\n## Model Fitting and Analysis of Variance (ANOVA)\n\nWe now fit a linear model to formally test the significance of the main effects and the interaction term. The model `life ~ material * temperature` is shorthand for `life ~ material + temperature + material:temperature`. We use a sum-to-zero contrast (`contr.sum`) for balanced interpretation of the effects. The **ANOVA table** will tell us if the variation caused by our factors is statistically significant compared to the random variation in the data.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## Fit the full factorial model\nbattery_fit <- lm(life ~ material * temperature, \n                  data = battery_df,\n                  contrasts = list(material = contr.sum, temperature = contr.sum))\n\nsummary(battery_fit)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = life ~ material * temperature, data = battery_df, \n    contrasts = list(material = contr.sum, temperature = contr.sum))\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-60.750 -14.625   1.375  17.938  45.250 \n\nCoefficients:\n                       Estimate Std. Error t value Pr(>|t|)    \n(Intercept)             105.528      4.331  24.367  < 2e-16 ***\nmaterial1               -22.361      6.125  -3.651  0.00111 ** \nmaterial2                 2.806      6.125   0.458  0.65057    \ntemperature1             39.306      6.125   6.418  7.1e-07 ***\ntemperature2              2.056      6.125   0.336  0.73975    \nmaterial1:temperature1   12.278      8.662   1.417  0.16778    \nmaterial2:temperature1    8.111      8.662   0.936  0.35735    \nmaterial1:temperature2  -27.972      8.662  -3.229  0.00325 ** \nmaterial2:temperature2    9.361      8.662   1.081  0.28936    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 25.98 on 27 degrees of freedom\nMultiple R-squared:  0.7652,\tAdjusted R-squared:  0.6956 \nF-statistic:    11 on 8 and 27 DF,  p-value: 9.426e-07\n```\n\n\n:::\n\n```{.r .cell-code}\n## Generate the ANOVA table\nanova(battery_fit)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nAnalysis of Variance Table\n\nResponse: life\n                     Df Sum Sq Mean Sq F value    Pr(>F)    \nmaterial              2  10684  5341.9  7.9114  0.001976 ** \ntemperature           2  39119 19559.4 28.9677 1.909e-07 ***\nmaterial:temperature  4   9614  2403.4  3.5595  0.018611 *  \nResiduals            27  18231   675.2                      \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n:::\n\n\n\n\nThe ANOVA table shows very small p-values (`Pr(>F)`) for `material`, `temperature`, and, most importantly, the `material:temperature` interaction. This confirms our visual inspection: all effects are statistically significant. **Because the interaction is significant, our interpretation should focus on the interaction itself rather than the main effects in isolation.**\n\n## Model Adequacy Checks\n\nThe validity of our ANOVA results depends on the model's residuals meeting certain assumptions (normality, constant variance, independence). We check these with diagnostic plots.\n\n\n\n\n::: {.cell layout-ncol=\"2\"}\n\n```{.r .cell-code}\n## Extract standardized residuals and fitted values\nbattery_fit_diag <- data.frame(\n  residuals = rstandard(battery_fit),\n  fitted = fitted.values(battery_fit)\n)\n\n## Normal Q-Q Plot\np1 <- ggplot(battery_fit_diag, aes(sample = residuals)) +\n  stat_qq() +\n  stat_qq_line() +\n  labs(title = \"Normal Q-Q Plot\", x = \"Theoretical Quantiles\", y = \"Standardized Residuals\") +\n  theme_minimal()\n\n## Residuals vs. Fitted Plot\np2 <- ggplot(battery_fit_diag, aes(x = fitted, y = residuals)) +\n  geom_point() +\n  geom_hline(yintercept = 0, linetype = \"dashed\", color = \"red\") +\n  labs(title = \"Residuals vs. Fitted Values\", x = \"Fitted Values\", y = \"Standardized Residuals\") +\n  theme_minimal()\n\np1 \n```\n\n::: {.cell-output-display}\n![Diagnostic plots for the battery life model.](factorial_files/figure-pdf/plot-diagnostics-1.pdf)\n:::\n\n```{.r .cell-code}\np2\n```\n\n::: {.cell-output-display}\n![Diagnostic plots for the battery life model.](factorial_files/figure-pdf/plot-diagnostics-2.pdf)\n:::\n:::\n\n\n\n\nThe Normal Q-Q plot shows the points falling roughly along the line, suggesting the normality assumption is met. The Residuals vs. Fitted plot shows a random scatter of points around the zero line, indicating that the variance is reasonably constant. The model assumptions appear to be satisfied.\n\n## Post-Hoc Analysis: Pairwise Comparisons\n\nSince the interaction is significant, we must compare the means of the nine specific treatment combinations (3 materials × 3 temperatures). Simply comparing the average effect of Material 1 vs. Material 2 would be misleading, as that difference depends on the temperature.\n\n## Tukey's HSD Test\n\n**Tukey's Honest Significant Difference (HSD)** test is a post-hoc test that compares all possible pairs of means while controlling the family-wise error rate. We apply it to an `aov` model object. The output for the `material:temperature` interaction shows which specific combinations are significantly different from one another.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## Fit the model using aov() for Tukey's test\nbattery_aov <- aov(life ~ material * temperature, data = battery_df)\n\n## Perform Tukey's HSD test\nTukeyHSD(battery_aov)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  Tukey multiple comparisons of means\n    95% family-wise confidence level\n\nFit: aov(formula = life ~ material * temperature, data = battery_df)\n\n$material\n        diff       lwr      upr     p adj\n2-1 25.16667 -1.135677 51.46901 0.0627571\n3-1 41.91667 15.614323 68.21901 0.0014162\n3-2 16.75000 -9.552344 43.05234 0.2717815\n\n$temperature\n            diff        lwr       upr     p adj\n70-15  -37.25000  -63.55234 -10.94766 0.0043788\n125-15 -80.66667 -106.96901 -54.36432 0.0000001\n125-70 -43.41667  -69.71901 -17.11432 0.0009787\n\n$`material:temperature`\n               diff         lwr        upr     p adj\n2:15-1:15     21.00  -40.823184  82.823184 0.9616404\n3:15-1:15      9.25  -52.573184  71.073184 0.9998527\n1:70-1:15    -77.50 -139.323184 -15.676816 0.0065212\n2:70-1:15    -15.00  -76.823184  46.823184 0.9953182\n3:70-1:15     11.00  -50.823184  72.823184 0.9994703\n1:125-1:15   -77.25 -139.073184 -15.426816 0.0067471\n2:125-1:15   -85.25 -147.073184 -23.426816 0.0022351\n3:125-1:15   -49.25 -111.073184  12.573184 0.2016535\n3:15-2:15    -11.75  -73.573184  50.073184 0.9991463\n1:70-2:15    -98.50 -160.323184 -36.676816 0.0003449\n2:70-2:15    -36.00  -97.823184  25.823184 0.5819453\n3:70-2:15    -10.00  -71.823184  51.823184 0.9997369\n1:125-2:15   -98.25 -160.073184 -36.426816 0.0003574\n2:125-2:15  -106.25 -168.073184 -44.426816 0.0001152\n3:125-2:15   -70.25 -132.073184  -8.426816 0.0172076\n1:70-3:15    -86.75 -148.573184 -24.926816 0.0018119\n2:70-3:15    -24.25  -86.073184  37.573184 0.9165175\n3:70-3:15      1.75  -60.073184  63.573184 1.0000000\n1:125-3:15   -86.50 -148.323184 -24.676816 0.0018765\n2:125-3:15   -94.50 -156.323184 -32.676816 0.0006078\n3:125-3:15   -58.50 -120.323184   3.323184 0.0742711\n2:70-1:70     62.50    0.676816 124.323184 0.0460388\n3:70-1:70     88.50   26.676816 150.323184 0.0014173\n1:125-1:70     0.25  -61.573184  62.073184 1.0000000\n2:125-1:70    -7.75  -69.573184  54.073184 0.9999614\n3:125-1:70    28.25  -33.573184  90.073184 0.8281938\n3:70-2:70     26.00  -35.823184  87.823184 0.8822881\n1:125-2:70   -62.25 -124.073184  -0.426816 0.0474675\n2:125-2:70   -70.25 -132.073184  -8.426816 0.0172076\n3:125-2:70   -34.25  -96.073184  27.573184 0.6420441\n1:125-3:70   -88.25 -150.073184 -26.426816 0.0014679\n2:125-3:70   -96.25 -158.073184 -34.426816 0.0004744\n3:125-3:70   -60.25 -122.073184   1.573184 0.0604247\n2:125-1:125   -8.00  -69.823184  53.823184 0.9999508\n3:125-1:125   28.00  -33.823184  89.823184 0.8347331\n3:125-2:125   36.00  -25.823184  97.823184 0.5819453\n```\n\n\n:::\n:::\n\n\n\n\n## Fisher's LSD Method\n\nThe **Fisher's Least Significant Difference (LSD)** method is another option for pairwise comparisons. To test the interaction means, we must specify both factors in the `trt` argument.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(agricolae)\n\n## Perform LSD test on the interaction term\nlsd_results <- LSD.test(battery_aov, trt = c(\"material\", \"temperature\"),\n                        p.adj = \"none\", group = FALSE)\n\n## Print the comparison table\nprint(lsd_results$comparison)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n              difference pvalue signif.         LCL        UCL\n1:125 - 1:15      -77.25 0.0003     *** -114.950479 -39.549521\n1:125 - 1:70        0.25 0.9892          -37.450479  37.950479\n1:125 - 2:125       8.00 0.6667          -29.700479  45.700479\n1:125 - 2:15      -98.25 0.0000     *** -135.950479 -60.549521\n1:125 - 2:70      -62.25 0.0022      **  -99.950479 -24.549521\n1:125 - 3:125     -28.00 0.1392          -65.700479   9.700479\n1:125 - 3:15      -86.50 0.0001     *** -124.200479 -48.799521\n1:125 - 3:70      -88.25 0.0001     *** -125.950479 -50.549521\n1:15 - 1:70        77.50 0.0002     ***   39.799521 115.200479\n1:15 - 2:125       85.25 0.0001     ***   47.549521 122.950479\n1:15 - 2:15       -21.00 0.2631          -58.700479  16.700479\n1:15 - 2:70        15.00 0.4214          -22.700479  52.700479\n1:15 - 3:125       49.25 0.0124       *   11.549521  86.950479\n1:15 - 3:15        -9.25 0.6187          -46.950479  28.450479\n1:15 - 3:70       -11.00 0.5544          -48.700479  26.700479\n1:70 - 2:125        7.75 0.6765          -29.950479  45.450479\n1:70 - 2:15       -98.50 0.0000     *** -136.200479 -60.799521\n1:70 - 2:70       -62.50 0.0021      ** -100.200479 -24.799521\n1:70 - 3:125      -28.25 0.1358          -65.950479   9.450479\n1:70 - 3:15       -86.75 0.0001     *** -124.450479 -49.049521\n1:70 - 3:70       -88.50 0.0000     *** -126.200479 -50.799521\n2:125 - 2:15     -106.25 0.0000     *** -143.950479 -68.549521\n2:125 - 2:70      -70.25 0.0007     *** -107.950479 -32.549521\n2:125 - 3:125     -36.00 0.0605       .  -73.700479   1.700479\n2:125 - 3:15      -94.50 0.0000     *** -132.200479 -56.799521\n2:125 - 3:70      -96.25 0.0000     *** -133.950479 -58.549521\n2:15 - 2:70        36.00 0.0605       .   -1.700479  73.700479\n2:15 - 3:125       70.25 0.0007     ***   32.549521 107.950479\n2:15 - 3:15        11.75 0.5279          -25.950479  49.450479\n2:15 - 3:70        10.00 0.5907          -27.700479  47.700479\n2:70 - 3:125       34.25 0.0732       .   -3.450479  71.950479\n2:70 - 3:15       -24.25 0.1980          -61.950479  13.450479\n2:70 - 3:70       -26.00 0.1685          -63.700479  11.700479\n3:125 - 3:15      -58.50 0.0036      **  -96.200479 -20.799521\n3:125 - 3:70      -60.25 0.0029      **  -97.950479 -22.549521\n3:15 - 3:70        -1.75 0.9248          -39.450479  35.950479\n```\n\n\n:::\n:::\n\n\n\n\nThe results from both Tukey's HSD and Fisher's LSD provide detailed p-values for comparing pairs of treatment combinations, allowing us to make specific conclusions, such as \"at 125°C, Material 3 has a significantly longer life than Materials 1 and 2.\"",
    "supporting": [
      "factorial_files/figure-pdf"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {
      "knitr": [
        "{\"type\":\"list\",\"attributes\":{},\"value\":[]}"
      ]
    },
    "preserve": null,
    "postProcess": false
  }
}