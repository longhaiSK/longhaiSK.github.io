/* Overlay Book TOC for Quarto — left-side drawer, no layout shift */

/* Tuning */
:root{
  --book-toc-width: 320px;
  --book-toc-offset: 64px;    /* scroll offset if you have a fixed header */
  --book-toc-z: 2000;
  --book-toc-font-size: 16px; /* TOC text size */
}

/* Only hide the built-in sidebar AFTER overlay is ready */
body.book-toc-ready #quarto-sidebar,
body.book-toc-ready .sidebar,
body.book-toc-ready .sidebar-navigation{
  display: none !important;
}

/* Expand content to full width only when ready */
body.book-toc-ready .page-columns,
body.book-toc-ready .quarto-container .page-columns{
  grid-template-columns: minmax(0,1fr) !important;
}

/* Always hide in-page TOC blocks that Quarto may place in the sidebar */
#quarto-sidebar .toc-active,
#quarto-sidebar nav[role="doc-toc"],
#quarto-sidebar #TOC,
#quarto-sidebar .sidebar-toc,
#quarto-sidebar .on-this-page,
nav.sidebar-navigation .toc-active{
  display: none !important;
}

/* Keep anchors visible under fixed headers */
main :is(h1,h2,h3,h4,h5,h6){ scroll-margin-top: var(--book-toc-offset); }

/* Toggle button (TOP-LEFT) */
#book-toc-toggle{
  position: fixed;
  top: calc(60px + env(safe-area-inset-top));
  left: calc(50px + env(safe-area-inset-left));
  z-index: calc(var(--book-toc-z) + 2);
  padding: .55rem .8rem;
  border: 1px solid #ddd; border-radius: 999px;
  background: #fff; cursor: pointer;
  box-shadow: 0 8px 24px rgba(0,0,0,.10);
  font: 500 14px system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
}

/* Backdrop */
#book-toc-backdrop{
  position: fixed; inset: 0;
  background: rgba(0,0,0,.25);
  opacity: 0; pointer-events: none;
  transition: opacity .2s ease;
  z-index: var(--book-toc-z);
}
body.book-toc-open #book-toc-backdrop{ opacity: 1; pointer-events: auto; }

/* Drawer panel (LEFT) */
#book-toc-panel{
  position: fixed; top: 0; left: 0; height: 100vh;
  width: var(--book-toc-width); max-width: 92vw; background: #fff;
  box-shadow: 16px 0 32px rgba(0,0,0,.08);
  transform: translateX(-100%);
  transition: transform .22s ease;
  z-index: calc(var(--book-toc-z) + 1);
  display: flex; flex-direction: column;
}
body.book-toc-open #book-toc-panel{ transform: translateX(0); }
body.book-toc-open{ overflow: hidden; }

/* Panel header */
#book-toc-head{
  display: flex; align-items: center; justify-content: space-between;
  gap: .5rem; padding: .75rem .9rem; border-bottom: 1px solid #eee;
}
#book-toc-head h3{ margin: 0; font: 600 14px system-ui,-apple-system,Segoe UI,Roboto,sans-serif; }
.toc-icon-btn{
  border: 1px solid #ddd; border-radius: 8px; padding: .35rem .55rem;
  background: #fff; cursor: pointer;
}

/* TOC content */
#book-toc-content{
  overflow: auto; padding: .6rem .85rem 1rem;
  line-height: 1.45; font-size: var(--book-toc-font-size);
}
#book-toc-content nav, #book-toc-content .book-toc{ line-height: 1.45; }
#book-toc-content ul{ list-style: none; margin: .25rem 0; padding-left: 1rem; }
#book-toc-content li{ margin: .1rem 0; }
#book-toc-content a{ text-decoration: none; }
#book-toc-content .lvl-1 > a{ font-weight: 600; }
#book-toc-content .lvl-2 > a{ font-weight: 500; }
#book-toc-content .lvl-3 > a{ font-weight: 400; }

/* Collapsible subsections */
.toc-row{ display: flex; align-items: center; gap: .25rem; }
.toc-caret{ margin-right: .35rem; user-select: none; cursor: pointer; }
.toc-collapsed > ul{ display: none; }
.toc-caret::before{
  content: '▾'; display: inline-block;
  transform: rotate(0deg); transition: transform .12s linear;
}
.toc-collapsed > .toc-row .toc-caret::before{ transform: rotate(-90deg); }

@media (max-width: 600px){
  :root{ --book-toc-width: 90vw; }
}

/* Make sure the toggle is always visible, even before we hide the sidebar */
#book-toc-toggle{
  position: fixed;
  top: calc(12px + env(safe-area-inset-top));
  left: calc(12px + env(safe-area-inset-left));
  z-index: 2147480000 !important;          /* huge z-index above Quarto UI */
  display: inline-block !important;        /* defeat any theme display:none */
  pointer-events: auto;
}

/* When Quarto's sidebar is still present (before .book-toc-ready),
   shove the toggle to the right of it so it doesn't sit underneath. 
   We try common CSS vars, with a 250px fallback. */
body:not(.book-toc-ready) #book-toc-toggle{
  left: calc(
    12px + env(safe-area-inset-left) +
    var(--quarto-sidebar-width, var(--sidebar-width, 250px))
  ) !important;
}

/* Also ensure our drawer sits above Quarto UI */
#book-toc-panel{ z-index: 2147479000 !important; }
#book-toc-backdrop{ z-index: 2147478000 !important; }

/* (Keep your existing rules that hide the sidebar ONLY after .book-toc-ready) */

